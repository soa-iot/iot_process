<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="cn.soa.dao.ProblemInfoMapper">
	<!-- ===========================1、查询===============================  -->
	<!-- 1.1 根据流程标识字段查询问题评估信息 -->
	<!-- ProblemInfo findByPiid(String piid); -->
	<sql id="problemInfoSelectSql">
		t_problem_rep_id tProblemRepId,
			piid,
			tas_id tasId,
			problemtype,
			wel_id welId,
			wel_name welName,
			adress,
			impacts,
			problemdescribe,
			resavepeople,
			applypeople,
			applydate,
			problemstate,
			remark,
			remarkone,
			remarktwo,
			remarkthree,
			supervisoryperson,
			maintenanceman,
			rectificationmeasures,
			rectificationperiod,
			is_sms isSms,
			sms_conment smsConment,
			sms_date smsDate,
			task_piid taskPiid,
			processtype,
			supervisorydate,
			supervisorydesc,
			tas_distribute tasDistribute,
			depart_or_central departOrCentral,
			ter_beginwork_date terBeginworkDate,
			ter_endwork_date terEndworkDate,
			ter_place terPlace,
			sp_id spId,
			sp_name spName,
			organization_site_officE organizationSiteOffice,
			office_problem officeProblem,
			materials_application materialsApplication,
			application_remark applicationRemark,
			controle_application controleApplication,
			ope_cm_id opeCmId,
			ope_card_no opecardNo,
			handle_ticket handleTicket,
			ticket_no ticketNo,
			corrective_action correctiveAction,
			action,
			others,
			remarkfive,
			remarksix,
			remarkseven,
			rfid,
			isdownload,
			problemnum,
			pho_name phoName,
			process_desc processDesc,
			pho_dispiay_name phoDispiayName,
			rectif_instruction rectifInstruction,
			pho_address phoAddress,
			gd_name gdName,
			work_permit workPermit,
			work_permit_number workPermitNumber,
			problemclass,
			profession,
			depet,
			inter_or_outer interOrOuter
	</sql>
		
<select id="queryProblempro" resultType="cn.soa.entity.ProblemInfo" >
    		select problemtype,problemstate from  (select piid,
			problemstate,
			CASE   when  PROBLEMTYPE='化验' then  '净化工段' 
								 	when  PROBLEMTYPE='净化工段' then  '净化工段' 
									when  PROBLEMTYPE='电站' then  '维修工段'
									when  PROBLEMTYPE='电气' then  '维修工段' 
									when  PROBLEMTYPE='仪表' then  '维修工段' 
								 	when  PROBLEMTYPE='机械' then  '维修工段'  
								 	when  PROBLEMTYPE='维修工段' then  '维修工段' 
									 when  PROBLEMTYPE='HSE办公室' then  'HSE办公室' 
									when  PROBLEMTYPE='财务经营办' then  '财务经营办' 
									when  PROBLEMTYPE='设备办' then  '设备办' 
									when  PROBLEMTYPE='生产办' then  '生产办' 
									when  PROBLEMTYPE='综合办' then  '综合办' 
								else null end problemtype 
  			from  CZ_TASK_PROBLEM_REPORT_NEW where piid is not null
) problemreport
           <where>			
    	<if test ="record!=null">
  				<if test='record.problemtype!=null'>
    		 and  problemtype =#{record.problemtype}
    			</if>
    	 </if>
    	   <if test='startTime!=null'>
    		and to_char(applydate,'YYYY-MM-DD') &gt;=#{startTime}
    	 </if>
    	  <if test='endTime!=null'>
    		and to_char(applydate,'YYYY-MM-DD') &lt;=#{endTime}
    	 </if>
    	  </where>	
  </select>
    <select id="count"  resultType="int">
  	  	select count(*) from  (
  		select CASE   when  PROBLEMTYPE='化验' then  '净化工段' 
								 when  PROBLEMTYPE='净化工段' then  '净化工段' 
									when  PROBLEMTYPE='电站' then  '维修工段'
									when  PROBLEMTYPE='电气' then  '维修工段' 
									when  PROBLEMTYPE='仪表' then  '维修工段' 
								 when  PROBLEMTYPE='机械' then  '维修工段'  
								 when  PROBLEMTYPE='维修工段' then  '维修工段' 
								 when  PROBLEMTYPE='HSE办公室' then  'HSE办公室' 
								when  PROBLEMTYPE='财务经营办' then  '财务经营办' 
								when  PROBLEMTYPE='设备办' then  '设备办' 
								when  PROBLEMTYPE='生产办' then  '生产办' 
								when  PROBLEMTYPE='综合办' then  '综合办' 
								else null end problemtype 
  			from  CZ_TASK_PROBLEM_REPORT_NEW 
  		) a
  		           <where>			
    	<if test ="record!=null">
  				<if test='record.problemtype!=null'>
    		 and  problemtype =#{record.problemtype}
    			</if>
    	 </if>
    	   <if test='startTime!=null'>
    		and to_char(applydate,'YYYY-MM-DD') &gt;=#{startTime}
    	 </if>
    	  <if test='endTime!=null'>
    		and to_char(applydate,'YYYY-MM-DD') &lt;=#{endTime}
    	 </if>
    	  </where>	
  </select>
		<!-- lixuefeng新增用于问题条件查询，返回list -->
	<!-- lixuefeng新增用于问题统计 -->
	<select id="statisticalTaskProblempro" resultType="map">
			select  CASE   when  PROBLEMTYPE='化验' then  '净化工段' 
								 when  PROBLEMTYPE='净化工段' then  '净化工段' 
									when  PROBLEMTYPE='电站' then  '维修工段'
									when  PROBLEMTYPE='电气' then  '维修工段' 
									when  PROBLEMTYPE='仪表' then  '维修工段' 
								 when  PROBLEMTYPE='机械' then  '维修工段'  
								 when  PROBLEMTYPE='维修工段' then  '维修工段' 
								 when  PROBLEMTYPE='HSE办公室' then  'HSE办公室' 
								when  PROBLEMTYPE='财务经营办' then  '财务经营办' 
								when  PROBLEMTYPE='设备办' then  '设备办' 
								when  PROBLEMTYPE='生产办' then  '生产办' 
								when  PROBLEMTYPE='综合办' then  '综合办' 
								else null end area ,  count(1) count,PROBLEMSTATE
  			from  CZ_TASK_PROBLEM_REPORT_NEW where TO_CHAR(APPLYDATE,'YYYY-MM-DD')  BETWEEN  #{beginTime} AND  #{endTime} AND PIID IS NOT NULL
  			GROUP BY  CASE   when  PROBLEMTYPE='化验' then  '净化工段' 
								 when  PROBLEMTYPE='净化工段' then  '净化工段' 
								when  PROBLEMTYPE='电站' then  '维修工段'
								when  PROBLEMTYPE='电气' then  '维修工段' 
								when  PROBLEMTYPE='仪表' then  '维修工段' 
								 when  PROBLEMTYPE='机械' then  '维修工段'  
								 when  PROBLEMTYPE='维修工段' then  '维修工段' 
								 when  PROBLEMTYPE='HSE办公室' then 'HSE办公室' 
								when  PROBLEMTYPE='财务经营办' then '财务经营办' 
								when  PROBLEMTYPE='设备办' then  '设备办' 
								when  PROBLEMTYPE='生产办' then  '生产办' 
								when  PROBLEMTYPE='综合办' then  '综合办' 
								 else null end,PROBLEMSTATE
	</select>
	
	<!-- 查看问题超期数量 -->
	<select id="findTimeState"   resultType="map">
		select  CASE   when  PROBLEMTYPE='化验' then  '净化工段' 
								 when  PROBLEMTYPE='净化工段' then  '净化工段' 
									when  PROBLEMTYPE='电站' then  '维修工段'
									when  PROBLEMTYPE='电气' then  '维修工段' 
									when  PROBLEMTYPE='仪表' then  '维修工段' 
								 when  PROBLEMTYPE='机械' then  '维修工段'  
								 when  PROBLEMTYPE='维修工段' then  '维修工段' 
								 when  PROBLEMTYPE='HSE办公室' then  'HSE办公室' 
								when  PROBLEMTYPE='财务经营办' then  '财务经营办' 
								when  PROBLEMTYPE='设备办' then  '设备办' 
								when  PROBLEMTYPE='生产办' then  '生产办' 
								when  PROBLEMTYPE='综合办' then  '综合办' 
								else null end area ,  count(1) count,REMARKTHREE
  			from  CZ_TASK_PROBLEM_REPORT_NEW where TO_CHAR(APPLYDATE,'YYYY-MM-DD')  BETWEEN  #{beginTime} AND  #{endTime} AND PIID IS NOT NULL
  			GROUP BY  CASE   when  PROBLEMTYPE='化验' then  '净化工段' 
								 when  PROBLEMTYPE='净化工段' then  '净化工段' 
								when  PROBLEMTYPE='电站' then  '维修工段'
								when  PROBLEMTYPE='电气' then  '维修工段' 
								when  PROBLEMTYPE='仪表' then  '维修工段' 
								 when  PROBLEMTYPE='机械' then  '维修工段'  
								 when  PROBLEMTYPE='维修工段' then  '维修工段' 
								 when  PROBLEMTYPE='HSE办公室' then 'HSE办公室' 
								when  PROBLEMTYPE='财务经营办' then '财务经营办' 
								when  PROBLEMTYPE='设备办' then  '设备办' 
								when  PROBLEMTYPE='生产办' then  '生产办' 
								when  PROBLEMTYPE='综合办' then  '综合办' 
								 else null end,REMARKTHREE
	</select>
	
	<select id="findByPiid"  resultType="cn.soa.entity.ProblemInfo">
		select 
			<include refid="problemInfoSelectSql"></include>
		from 
			CZ_TASK_PROBLEM_REPORT_NEW 
		where 
			piid = #{piid}
	</select>
	
	<!-- 分页查找问题上报信息  -->
	<!-- List<ProblemInfo> findPorblemInfoByPage(
			@Param("record") ProblemInfo problemInfo,
			@Param("page") Integer page,
			@Param("limit") Integer limit, 
			@Param("startTime") String startTime,
			@Param("endTime") String endTime,
			@Param("sortField") String sortField,
			@Param("sortType") String sortType) -->
	<select id="findPorblemInfoByPage" resultType="cn.soa.entity.ProblemInfo">
		SELECT
			<include refid="problemInfoSelectSql"></include>
		FROM
			(
				SELECT ROWNUM rownum1, REPORT_NEW.*
				FROM 
					( 
						SELECT * FROM CZ_TASK_PROBLEM_REPORT_NEW
						<where>
							<if test="record != null and record.piids != null">
								PIID IN 
								<foreach collection="record.piids" index="index" item="item" open="(" separator="," close=")">
									#{item}
								</foreach>
							</if>
						</where>
						<choose>
								<when test="sortField != null and sortField != ''">
									ORDER BY ${sortField} ${sortType}
								</when>
								<otherwise>
									ORDER BY applydate DESC
								</otherwise>
						</choose>
					) REPORT_NEW
				<where>
					<if test="record != null">
					   <if test="record.tProblemRepId != null and record.tProblemRepId != ''">
					   		T_PROBLEM_REP_ID = #{record.tProblemRepId}
					   </if>
					   <if test="record.piid != null and record.piid != ''">
					   		and piid = #{record.piid}
					   </if>
					    <if test="record.tasId != null and record.tasId != ''">
					   		and tas_id = #{record.tasId}
					   </if>
					   <if test="record.problemtype != null and record.problemtype != ''">
					   		<choose>
					   			<when test="record.problemtype == '维修工段'">
					   				and PROBLEMTYPE IN ('电站', '电气', '仪表', '机械', '维修工段')
					   			</when>
					   			<when test="record.problemtype == '净化工段'">
					   				and PROBLEMTYPE IN ('净化工段', '化验')
					   			</when>
					   			<otherwise>
					   				and PROBLEMTYPE = #{record.problemtype}
					   			</otherwise>
					   		</choose>
					   </if>
					   <if test="record.welId != null and record.welId != ''">
					   		and wel_id = #{record.welId}
					   </if>
					   <if test="record.welName != null and record.welName != ''">
					   		and WEL_NAME = #{record.welName}
					   </if>
					   <if test="record.adress != null and record.adress != ''">
					   		and adress = #{record.adress}
					   </if>
					   <if test="record.impacts != null and record.impacts != ''">
					   		and impacts = #{record.impacts}
					   </if>
					   <if test="record.problemdescribe != null and record.problemdescribe != ''">
					   		and PROBLEMDESCRIBE LIKE '%${record.problemdescribe}%'
					   </if>
					   <if test="record.resavepeople != null and record.resavepeople != ''">
					   		and RESAVEPEOPLE = #{record.resavepeople}
					   </if>
					   <if test="record.applypeople != null and record.applypeople != ''">
					   		and APPLYPEOPLE LIKE '%${record.applypeople}%'
					   </if>
					   <if test="record.problemstate != null and record.problemstate != ''">
					   		and PROBLEMSTATE = #{record.problemstate}
					   </if>
					   <if test="record.remark != null and record.remark != ''">
					   		and remark = #{record.remark}
					   </if>
					   <if test="record.remarkone != null and record.remarkone != ''">
					   		and remarkone = #{record.remarkone}
					   </if>
					   <if test="record.remarktwo != null and record.remarktwo != ''">
					   		and remarktwo = #{record.remarktwo}
					   </if>
					   <if test="record.remarkthree != null and record.remarkthree != ''">
					   		and remarkthree = #{record.remarkthree}
					   </if>
					   <if test="record.supervisoryperson != null and record.supervisoryperson != ''">
					   		and supervisoryperson = #{record.supervisoryperson}
					   </if>
					   <if test="record.maintenanceman != null and record.maintenanceman != ''">
					   		and maintenanceman LIKE '%${record.maintenanceman}%'
					   </if>
					   <if test="record.rectificationmeasures != null and record.rectificationmeasures != ''">
					   		and rectificationmeasures = #{record.rectificationmeasures}
					   </if>
					   <if test="record.isSms != null and record.isSms != ''">
					   		and is_sms = #{record.isSms}
					   </if>
					   <if test="record.smsConment != null and record.smsConment != ''">
					   		and sms_conment = #{record.smsConment}
					   </if>
					   <if test="record.taskPiid != null and record.taskPiid != ''">
					   		and task_piid = #{record.taskPiid}
					   </if>
					   <if test="record.processtype != null and record.processtype != ''">
					   		and processtype = #{record.processtype}
					   </if>
					   <if test="record.supervisorydesc != null and record.supervisorydesc != ''">
					   		and supervisorydesc = #{record.supervisorydesc}
					   </if>
					   <if test="record.tasDistribute != null and record.tasDistribute != ''">
					   		and tas_distribute = #{record.tasDistribute}
					   </if>
					   <if test="record.departOrCentral != null and record.departOrCentral != ''">
					   		and depart_or_central = #{record.departOrCentral}
					   </if>
					   <if test="record.terPlace != null and record.terPlace != ''">
					   		and ter_place = #{record.terPlace}
					   </if>
					   <if test="record.spId != null and record.spId != ''">
					   		and sp_id = #{record.spId}
					   </if>
					   <if test="record.spName != null and record.spName != ''">
					   		and sp_name = #{record.spName}
					   </if>
					   <if test="record.organizationSiteOffice != null and record.organizationSiteOffice != ''">
					   		and organization_site_officE = #{record.organizationSiteOffice}
					   </if>
					   <if test="record.officeProblem != null and record.officeProblem != ''">
					   		and office_problem = #{record.officeProblem}
					   </if>
					   <if test="record.materialsApplication != null and record.materialsApplication != ''">
					   		and materials_application = #{record.materialsApplication}
					   </if>
					   <if test="record.applicationRemark != null and record.applicationRemark != ''">
					   		and application_remark = #{record.applicationRemark}
					   </if>
					   <if test="record.controleApplication != null and record.controleApplication != ''">
					   		and controle_application = #{record.controleApplication}
					   </if>
					   <if test="record.opeCmId != null and record.opeCmId != ''">
					   		and ope_cm_id = #{record.opeCmId}
					   </if>
					   <if test="record.opecardNo != null and record.opecardNo != ''">
					   		and ope_card_no = #{record.opecardNo}
					   </if>
					   <if test="record.handleTicket != null and record.handleTicket != ''">
					   		and handle_ticket = #{record.handleTicket}
					   </if>
					   <if test="record.ticketNo != null and record.ticketNo != ''">
					   		and ticket_no = #{record.ticketNo}
					   </if>
					   <if test="record.correctiveAction != null and record.correctiveAction != ''">
					   		and corrective_action = #{record.correctiveAction}
					   </if>
					   <if test="record.action != null and record.action != ''">
					   		and action = #{record.action}
					   </if>
					   <if test="record.others != null and record.others != ''">
					   		and others = #{record.others}
					   </if>
					   <if test="record.remarkfive != null and record.remarkfive != ''">
					   		and REMARKFIVE = #{record.remarkfive}
					   </if>
					   <if test="record.remarksix != null and record.remarksix != ''">
					   		and REMARKSIX = #{record.remarksix}
					   </if>
					   <if test="record.remarkseven != null and record.remarkseven != ''">
					   		and remarkseven = #{record.remarkseven}
					   </if>
					   <if test="record.rfid != null and record.rfid != ''">
					   		and RFID = #{record.rfid}
					   </if>
					   <if test="record.isdownload != null and record.isdownload != ''">
					   		and isdownload = #{record.isdownload}
					   </if>
					   <if test="record.problemnum != null">
					   		and PROBLEMNUM = #{record.problemnum}
					   </if>
					   <if test="record.phoName != null and record.phoName != ''">
					   		and pho_name = #{record.phoName}
					   </if>
					   <if test="record.processDesc != null and record.processDesc != ''">
					   		and process_desc = #{record.processDesc}
					   </if>
					   <if test="record.phoDispiayName != null and record.phoDispiayName != ''">
					   		and pho_dispiay_name = #{record.phoDispiayName}
					   </if>
					   <if test="record.rectifInstruction != null and record.rectifInstruction != ''">
					   		and rectif_instruction = #{record.rectifInstruction}
					   </if>
					   <if test="record.phoAddress != null and record.phoAddress != ''">
					   		and pho_address = #{record.phoAddress}
					   </if>
					   <if test="record.gdName != null and record.gdName != ''">
					   		and gd_name = #{record.gdName}
					   </if>
					   <if test="record.workPermit != null and record.workPermit != ''">
					   		and work_permit = #{record.workPermit}
					   </if>
					   <if test="record.workPermitNumber != null and record.workPermitNumber != ''">
					   		and work_permit_number = #{record.workPermitNumber}
					   </if>
					   <if test="record.problemclass != null and record.problemclass != ''">
					   		and PROBLEMCLASS = #{record.problemclass}
					   </if>
					   <if test="record.profession != null and record.profession != ''">
					   		and PROFESSION = #{record.profession}
					   </if>
					   <if test="record.depet != null and record.depet != ''">
					   		
					   		<choose>
					   			<when test="record.depet == '维修工段' ">
					   				and depet IN ('电站','电工班','钳工班','仪表班','维修班','电站班','管焊班','维修工段')
					   			</when>
					   			<when test="record.depet == '净化工段' ">
					   				and depet IN ('净化1班','净化4班','净化2班','净化3班','行政班','分析班')
					   			</when>
					   			<when test="record.depet == 'HSE办公室' ">
					   				and depet IN ('HSE办公室')
					   			</when>
					   			<when test="record.depet == '设备办' ">
					   				and depet IN ('设备办','设备办公室')
					   			</when>
					   			<when test="record.depet == '生产办' ">
					   				and depet IN ('生产办','生产办公室')
					   			</when>
					   			<when test="record.depet == '财务经营办' ">
					   				and depet IN ('财务经营办','财务办公室')
					   			</when>
					   			<when test="record.depet == '综合办' ">
					   				and depet IN ('综合办','综合办公室')
					   			</when>
					   			<otherwise>
					   				and depet = #{record.depet}
					   			</otherwise>
					   		</choose>
					   </if>
					   <if test="record.interOrOuter != null and record.interOrOuter != ''">
					   		and inter_or_outer = #{record.interOrOuter}
					   </if>
					   <if test="record.outerDealDescribe != null and record.outerDealDescribe != ''">
					   		and outer_deal_describe = #{record.outerDealDescribe}
					   </if>
					   <if test="record.dueDate != null and record.dueDate != ''">
					   		and to_char(rectificationperiod,'YYYY-MM-DD') = #{record.dueDate}
					   </if>
					   <if test="record.duedateRange != null and record.duedateRange != ''">
					   		and to_char(rectificationperiod,'YYYY-MM-DD') &lt;= #{record.duedateRange} and to_char(rectificationperiod,'YYYY-MM-DD') &gt;= to_char(sysdate, 'YYYY-MM-DD')
					   </if>
					</if>
					<if test="startTime!=null and startTime!=''">
			    		and to_char(applydate,'YYYY-MM-DD') &gt;=#{startTime}
			    	</if>
			    	<if test="endTime!=null and endTime!=''">
			    		and to_char(applydate,'YYYY-MM-DD') &lt;=#{endTime}
			    	</if>
					<if test="limit != null and limit != ''">
						and ROWNUM &lt;= (${limit}*${page})
					</if>
				</where>
			) probleminfo 
		<where>
			<if test="page != null and page != ''">
				rownum1 &gt; (${limit}*(${page}-1))
			</if>
		</where>
			
	</select>
	
	<select id="PorblemCount" resultType="map">
		SELECT COUNT(1) total,COUNT(CASE when problemstate='FINISHED' THEN '1' else null end) complete
				FROM 
					(
						SELECT * FROM CZ_TASK_PROBLEM_REPORT_NEW
						<where>
							<if test="record != null and record.piids != null">
								PIID IN 
								<foreach collection="record.piids" index="index" item="item" open="(" separator="," close=")">
									#{item}
								</foreach>
							</if>
						</where>
					) REPORT_NEW
				<where>
					<if test="record != null">
					   <if test="record.tProblemRepId != null and record.tProblemRepId != ''">
					   		T_PROBLEM_REP_ID = #{record.tProblemRepId}
					   </if>
					   <if test="record.piid != null and record.piid != ''">
					   		and piid = #{record.piid}
					   </if>
					    <if test="record.tasId != null and record.tasId != ''">
					   		and tas_id = #{record.tasId}
					   </if>
					   <if test="record.problemtype != null and record.problemtype != ''">
					   		<choose>
					   			<when test="record.problemtype == '维修工段'">
					   				and PROBLEMTYPE IN ('电站', '电气', '仪表', '机械', '维修工段')
					   			</when>
					   			<when test="record.problemtype == '净化工段'">
					   				and PROBLEMTYPE IN ('净化工段', '化验')
					   			</when>
					   			<otherwise>
					   				and PROBLEMTYPE = #{record.problemtype}
					   			</otherwise>
					   		</choose>
					   </if>
					   <if test="record.welId != null and record.welId != ''">
					   		and wel_id = #{record.welId}
					   </if>
					   <if test="record.welName != null and record.welName != ''">
					   		and WEL_NAME = #{record.welName}
					   </if>
					   <if test="record.adress != null and record.adress != ''">
					   		and adress = #{record.adress}
					   </if>
					   <if test="record.impacts != null and record.impacts != ''">
					   		and impacts = #{record.impacts}
					   </if>
					   <if test="record.problemdescribe != null and record.problemdescribe != ''">
					   		and PROBLEMDESCRIBE LIKE '%${record.problemdescribe}%'
					   </if>
					   <if test="record.resavepeople != null and record.resavepeople != ''">
					   		and RESAVEPEOPLE = #{record.resavepeople}
					   </if>
					   <if test="record.applypeople != null and record.applypeople != ''">
					   		and APPLYPEOPLE LIKE '%${record.applypeople}%'
					   </if>
					   <if test="record.problemstate != null and record.problemstate != ''">
					   		and PROBLEMSTATE = #{record.problemstate}
					   </if>
					   <if test="record.remark != null and record.remark != ''">
					   		and remark = #{record.remark}
					   </if>
					   <if test="record.remarkone != null and record.remarkone != ''">
					   		and remarkone = #{record.remarkone}
					   </if>
					   <if test="record.remarktwo != null and record.remarktwo != ''">
					   		and remarktwo = #{record.remarktwo}
					   </if>
					   <if test="record.remarkthree != null and record.remarkthree != ''">
					   		and remarkthree = #{record.remarkthree}
					   </if>
					   <if test="record.supervisoryperson != null and record.supervisoryperson != ''">
					   		and supervisoryperson = #{record.supervisoryperson}
					   </if>
					   <if test="record.maintenanceman != null and record.maintenanceman != ''">
					   		and maintenanceman LIKE '%${record.maintenanceman}%'
					   </if>
					   <if test="record.rectificationmeasures != null and record.rectificationmeasures != ''">
					   		and rectificationmeasures = #{record.rectificationmeasures}
					   </if>
					   <if test="record.isSms != null and record.isSms != ''">
					   		and is_sms = #{record.isSms}
					   </if>
					   <if test="record.smsConment != null and record.smsConment != ''">
					   		and sms_conment = #{record.smsConment}
					   </if>
					   <if test="record.taskPiid != null and record.taskPiid != ''">
					   		and task_piid = #{record.taskPiid}
					   </if>
					   <if test="record.processtype != null and record.processtype != ''">
					   		and processtype = #{record.processtype}
					   </if>
					   <if test="record.supervisorydesc != null and record.supervisorydesc != ''">
					   		and supervisorydesc = #{record.supervisorydesc}
					   </if>
					   <if test="record.tasDistribute != null and record.tasDistribute != ''">
					   		and tas_distribute = #{record.tasDistribute}
					   </if>
					   <if test="record.departOrCentral != null and record.departOrCentral != ''">
					   		and depart_or_central = #{record.departOrCentral}
					   </if>
					   <if test="record.terPlace != null and record.terPlace != ''">
					   		and ter_place = #{record.terPlace}
					   </if>
					   <if test="record.spId != null and record.spId != ''">
					   		and sp_id = #{record.spId}
					   </if>
					   <if test="record.spName != null and record.spName != ''">
					   		and sp_name = #{record.spName}
					   </if>
					   <if test="record.organizationSiteOffice != null and record.organizationSiteOffice != ''">
					   		and organization_site_officE = #{record.organizationSiteOffice}
					   </if>
					   <if test="record.officeProblem != null and record.officeProblem != ''">
					   		and office_problem = #{record.officeProblem}
					   </if>
					   <if test="record.materialsApplication != null and record.materialsApplication != ''">
					   		and materials_application = #{record.materialsApplication}
					   </if>
					   <if test="record.applicationRemark != null and record.applicationRemark != ''">
					   		and application_remark = #{record.applicationRemark}
					   </if>
					   <if test="record.controleApplication != null and record.controleApplication != ''">
					   		and controle_application = #{record.controleApplication}
					   </if>
					   <if test="record.opeCmId != null and record.opeCmId != ''">
					   		and ope_cm_id = #{record.opeCmId}
					   </if>
					   <if test="record.opecardNo != null and record.opecardNo != ''">
					   		and ope_card_no = #{record.opecardNo}
					   </if>
					   <if test="record.handleTicket != null and record.handleTicket != ''">
					   		and handle_ticket = #{record.handleTicket}
					   </if>
					   <if test="record.ticketNo != null and record.ticketNo != ''">
					   		and ticket_no = #{record.ticketNo}
					   </if>
					   <if test="record.correctiveAction != null and record.correctiveAction != ''">
					   		and corrective_action = #{record.correctiveAction}
					   </if>
					   <if test="record.action != null and record.action != ''">
					   		and action = #{record.action}
					   </if>
					   <if test="record.others != null and record.others != ''">
					   		and others = #{record.others}
					   </if>
					   <if test="record.remarkfive != null and record.remarkfive != ''">
					   		and REMARKFIVE = #{record.remarkfive}
					   </if>
					   <if test="record.remarksix != null and record.remarksix != ''">
					   		and REMARKSIX = #{record.remarksix}
					   </if>
					   <if test="record.remarkseven != null and record.remarkseven != ''">
					   		and remarkseven = #{record.remarkseven}
					   </if>
					   <if test="record.rfid != null and record.rfid != ''">
					   		and RFID = #{record.rfid}
					   </if>
					   <if test="record.isdownload != null and record.isdownload != ''">
					   		and isdownload = #{record.isdownload}
					   </if>
					   <if test="record.problemnum != null">
					   		and PROBLEMNUM = #{record.problemnum}
					   </if>
					   <if test="record.phoName != null and record.phoName != ''">
					   		and pho_name = #{record.phoName}
					   </if>
					   <if test="record.processDesc != null and record.processDesc != ''">
					   		and process_desc = #{record.processDesc}
					   </if>
					   <if test="record.phoDispiayName != null and record.phoDispiayName != ''">
					   		and pho_dispiay_name = #{record.phoDispiayName}
					   </if>
					   <if test="record.rectifInstruction != null and record.rectifInstruction != ''">
					   		and rectif_instruction = #{record.rectifInstruction}
					   </if>
					   <if test="record.phoAddress != null and record.phoAddress != ''">
					   		and pho_address = #{record.phoAddress}
					   </if>
					   <if test="record.gdName != null and record.gdName != ''">
					   		and gd_name = #{record.gdName}
					   </if>
					   <if test="record.workPermit != null and record.workPermit != ''">
					   		and work_permit = #{record.workPermit}
					   </if>
					   <if test="record.workPermitNumber != null and record.workPermitNumber != ''">
					   		and work_permit_number = #{record.workPermitNumber}
					   </if>
					   <if test="record.problemclass != null and record.problemclass != ''">
					   		and PROBLEMCLASS = #{record.problemclass}
					   </if>
					   <if test="record.profession != null and record.profession != ''">
					   		and PROFESSION = #{record.profession}
					   </if>
					   <if test="record.depet != null and record.depet != ''">
					   		
					   		<choose>
					   			<when test="record.depet == '维修工段' ">
					   				and depet IN ('电站','电工班','钳工班','仪表班','维修班','电站班','管焊班','维修工段')
					   			</when>
					   			<when test="record.depet == '净化工段' ">
					   				and depet IN ('净化1班','净化4班','净化2班','净化3班','行政班','分析班')
					   			</when>
					   			<when test="record.depet == 'HSE办公室' ">
					   				and depet IN ('HSE办公室')
					   			</when>
					   			<when test="record.depet == '设备办' ">
					   				and depet IN ('设备办','设备办公室')
					   			</when>
					   			<when test="record.depet == '生产办' ">
					   				and depet IN ('生产办','生产办公室')
					   			</when>
					   			<when test="record.depet == '财务经营办' ">
					   				and depet IN ('财务经营办','财务办公室')
					   			</when>
					   			<when test="record.depet == '综合办' ">
					   				and depet IN ('综合办','综合办公室')
					   			</when>
					   			<otherwise>
					   				and depet = #{record.depet}
					   			</otherwise>
					   		</choose>
					   </if>
					   <if test="record.interOrOuter != null and record.interOrOuter != ''">
					   		and inter_or_outer = #{record.interOrOuter}
					   </if>
					   <if test="record.outerDealDescribe != null and record.outerDealDescribe != ''">
					   		and outer_deal_describe = #{record.outerDealDescribe}
					   </if>
					   <if test="record.dueDate != null and record.dueDate != ''">
					   		and to_char(rectificationperiod,'YYYY-MM-DD') = #{record.dueDate}
					   </if>
					   <if test="record.duedateRange != null and record.duedateRange != ''">
					   		and to_char(rectificationperiod,'YYYY-MM-DD') &lt;= #{record.duedateRange} and to_char(rectificationperiod,'YYYY-MM-DD') &gt;= to_char(sysdate, 'YYYY-MM-DD')
					   </if>
					</if>
					<if test="startTime!=null and startTime!=''">
			    		and to_char(applydate,'YYYY-MM-DD') &gt;=#{startTime}
			    	</if>
			    	<if test="endTime!=null and endTime!=''">
			    		and to_char(applydate,'YYYY-MM-DD') &lt;=#{endTime}
			    	</if>
				</where>
		</select>
	
	<!-- 1.2、根据问题报告主键id查找暂存状态的问题报告  -->
	<!-- public ProblemInfo findByRepId(String RepId) -->

	<select id="findByRepId" resultType="cn.soa.entity.ProblemInfo">
		SELECT
			<include refid="problemInfoSelectSql"></include>
		FROM
			CZ_TASK_PROBLEM_REPORT_NEW
		WHERE
			T_PROBLEM_REP_ID = #{RepId, jdbcType=VARCHAR} AND PIID is null			
	</select>
	
	<!-- 1.3、根据当前登录人或piid查找问题报告  -->
	<!-- public ProblemInfoVO findByResavepeopleOrPiid(
			@Param("resavepeople") String resavepeople, 
			@Param("pidd") String piid); -->
	
	<resultMap type="cn.soa.entity.ProblemInfoVO" id="problemInfoVOResultMap">
		<id property="tProblemRepId" column="REP_ID" />
		<result property="applypeople" column="APPLYPEOPLE" />
		<result property="problemnum" column="proNum" />
		<result property="problemtype" column="PROBLEMTYPE" />
		<result property="welName" column="WEL_NAME" />
		<result property="profession" column="PROFESSION" />
		<result property="rfid" column="RFID" />
		<result property="problemclass" column="PROBLEMCLASS" />
		<result property="remarkfive" column="REMARKFIVE" />
		<result property="remarksix" column="REMARKSIX" />
		<result property="problemdescribe" column="PROBLEMDESCRIBE" />
		<result property="resavepeople" column="RESAVEPEOPLE" />
		<collection property="reportPhos" ofType="cn.soa.entity.ProblemReportpho" >
			<id property="tProblemPhoId" column="T_PROBLEM_PHO_ID" />
			<result property="tProblemRepId" column="REP_ID1" />
			<result property="phoName" column="phoName" />
			<result property="phoAddress" column="phoAddress" />
			<result property="phoDispiayName" column="phoDisplayName" />
			<result property="phoUploadPeople" column="phoUploadPeople" />
		</collection>
	</resultMap>
	
	<select id="findByResavepeopleOrPiid"  resultMap="problemInfoVOResultMap">
		SELECT
			pr.T_PROBLEM_REP_ID REP_ID, prp.T_PROBLEM_REP_ID REP_ID1, pr.PROBLEMNUM proNum, APPLYPEOPLE, PROBLEMTYPE,WEL_NAME,PROFESSION,
			RFID,PROBLEMCLASS,REMARKFIVE,REMARKSIX,PROBLEMDESCRIBE,RESAVEPEOPLE,T_PROBLEM_PHO_ID, prp.PHO_NAME phoName,
			prp.PHO_ADDRESS phoAddress, prp.PHO_DISPIAY_NAME phoDisplayName,prp.PHO_UPLOAD_PEOPLE phoUploadPeople
		FROM
			CZ_TASK_PROBLEM_REPORT_NEW pr LEFT JOIN CZ_TASK_PROBLEM_REPORTPHO prp
			ON pr.T_PROBLEM_REP_ID = prp.T_PROBLEM_REP_ID
	    <where>
	    	<choose>
	    		<when test="resavepeople != null and resavepeople != ''">
	    			RESAVEPEOPLE = #{resavepeople, jdbcType=VARCHAR} AND pr.PIID is null
	    		</when>
	    		<when test="piid != null and piid != ''">
	    			pr.PIID = #{piid, jdbcType=VARCHAR}
	    		</when>
	    		<otherwise>
	    			1 = 2
	    		</otherwise>
	    	</choose>
	    </where>			
	</select>
	
	<!-- 1.4、根据问题报告主键id查找问题报告    -->
	<!-- public Integer findMaxProblemNum() -->
	<select id="findMaxProblemNum" resultType="java.lang.Integer">
		SELECT MAX(PROBLEMNUM) ma FROM CZ_TASK_PROBLEM_REPORT_NEW
	</select>
	
	<!-- 1.5、根据用户名查找上报申请用户    -->
	<!-- public String findApplyPeople(String name) -->
	<select id="findApplyPeople" resultType="string">
		SELECT PARENT_ID FROM IOT_USER_ORGANIZATION WHERE NAME = #{name, jdbcType=VARCHAR}
	</select>
	
	<!-- 1.6、查询所有未完成的问题上报任务    -->
	<select id="findUnfinished" resultType="cn.soa.entity.ProblemInfo">
		SELECT * FROM CZ_TASK_PROBLEM_REPORT_NEW 
		WHERE PROBLEMSTATE = 'UNFINISHED'
	</select>
	
	<!-- 1.6、查询所有问题状态为‘未超期’和未完成的的问题   -->
	<select id="findUnfinishedAndTimeover" resultType="cn.soa.entity.ProblemInfo">
		SELECT * FROM CZ_TASK_PROBLEM_REPORT_NEW 
		WHERE REMARKTHREE like '%未超期%' 
		and PROBLEMSTATE = 'UNFINISHED' 
		and remark like '%指定日期%'
	</select>
	
	<!-- ===========================2、新增===============================  -->
	<!-- 2.1、添加一条问题报告数据 	-->
	<!-- public Integer insertOne(ProblemInfo info)	 -->
	<insert id="insertOne" parameterType="cn.soa.entity.ProblemInfo">
		<selectKey keyProperty="tProblemRepId" order="BEFORE" resultType="java.lang.String">
			select sys_guid() from dual
		</selectKey>
		INSERT INTO
			CZ_TASK_PROBLEM_REPORT_NEW
			<trim prefix="(" suffix=")" suffixOverrides=",">
			   <if test="tProblemRepId != null and tProblemRepId != ''">
			   		T_PROBLEM_REP_ID,
			   </if>
			   <if test="piid != null and piid != ''">
			   		PIID,
			   </if>
			    <if test="tasId != null and tasId != ''">
			   		tas_id,
			   </if>
			   <if test="problemtype != null and problemtype != ''">
			   		PROBLEMTYPE,
			   </if>
			   <if test="welId != null and welId != ''">
			   		wel_id,
			   </if>
			   <if test="welName != null and welName != ''">
			   		WEL_NAME,
			   </if>
			   <if test="adress != null and adress != ''">
			   		adress,
			   </if>
			   <if test="impacts != null and impacts != ''">
			   		impacts,
			   </if>
			   <if test="problemdescribe != null and problemdescribe != ''">
			   		PROBLEMDESCRIBE,
			   </if>
			   <if test="resavepeople != null and resavepeople != ''">
			   		RESAVEPEOPLE,
			   </if>
			   <if test="applypeople != null and applypeople != ''">
			   		APPLYPEOPLE,
			   </if>
			   <if test="applydate != null">
			   		APPLYDATE,
			   </if>
			   <if test="problemstate != null and problemstate != ''">
			   		PROBLEMSTATE,
			   </if>
			   <if test="remark != null and remark != ''">
			   		remark,
			   </if>
			   <if test="remarkone != null and remarkone != ''">
			   		remarkone,
			   </if>
			   <if test="remarktwo != null and remarktwo != ''">
			   		remarktwo,
			   </if>
			   <if test="remarkthree != null and remarkthree != ''">
			   		remarkthree,
			   </if>
			   <if test="supervisoryperson != null and supervisoryperson != ''">
			   		supervisoryperson,
			   </if>
			   <if test="maintenanceman != null and maintenanceman != ''">
			   		maintenanceman,
			   </if>
			   <if test="rectificationmeasures != null and rectificationmeasures != ''">
			   		rectificationmeasures,
			   </if>
			   <if test="rectificationperiod != null and rectificationperiod != ''">
			   		rectificationperiod,
			   </if>
			   <if test="isSms != null and isSms != ''">
			   		is_sms,
			   </if>
			   <if test="smsConment != null and smsConment != ''">
			   		sms_conment,
			   </if>
			   <if test="smsDate != null">
			   		sms_date,
			   </if>
			   <if test="taskPiid != null and taskPiid != ''">
			   		task_piid,
			   </if>
			   <if test="processtype != null and processtype != ''">
			   		processtype,
			   </if>
			   <if test="supervisorydate != null">
			   		supervisorydate,
			   </if>
			   <if test="supervisorydesc != null and supervisorydesc != ''">
			   		supervisorydesc,
			   </if>
			   <if test="tasDistribute != null and tasDistribute != ''">
			   		tas_distribute,
			   </if>
			   <if test="departOrCentral != null and departOrCentral != ''">
			   		depart_or_central,
			   </if>
			   <if test="terBeginworkDate != null">
			   		ter_beginwork_date,
			   </if>
			   <if test="terEndworkDate != null">
			   		ter_endwork_date,
			   </if>
			   <if test="terPlace != null and terPlace != ''">
			   		ter_place,
			   </if>
			   <if test="spId != null and spId != ''">
			   		sp_id,
			   </if>
			   <if test="spName != null and spName != ''">
			   		sp_name,
			   </if>
			   <if test="organizationSiteOffice != null and organizationSiteOffice != ''">
			   		organization_site_officE,
			   </if>
			   <if test="officeProblem != null and officeProblem != ''">
			   		office_problem,
			   </if>
			   <if test="materialsApplication != null and materialsApplication != ''">
			   		materials_application,
			   </if>
			   <if test="applicationRemark != null and applicationRemark != ''">
			   		application_remark,
			   </if>
			   <if test="controleApplication != null and controleApplication != ''">
			   		controle_application,
			   </if>
			   <if test="opeCmId != null and opeCmId != ''">
			   		ope_cm_id,
			   </if>
			   <if test="opecardNo != null and opecardNo != ''">
			   		ope_card_no,
			   </if>
			   <if test="handleTicket != null and handleTicket != ''">
			   		handle_ticket,
			   </if>
			   <if test="ticketNo != null and ticketNo != ''">
			   		ticket_no,
			   </if>
			   <if test="correctiveAction != null and correctiveAction != ''">
			   		corrective_action,
			   </if>
			   <if test="action != null and action != ''">
			   		action,
			   </if>
			   <if test="others != null and others != ''">
			   		others,
			   </if>
			   <if test="remarkfive != null and remarkfive != ''">
			   		REMARKFIVE,
			   </if>
			   <if test="remarksix != null and remarksix != ''">
			   		REMARKSIX,
			   </if>
			   <if test="remarkseven != null and remarkseven != ''">
			   		remarkseven,
			   </if>
			   <if test="rfid != null and rfid != ''">
			   		RFID,
			   </if>
			   <if test="isdownload != null and isdownload != ''">
			   		isdownload,
			   </if>
			   <if test="problemnum != null">
			   		PROBLEMNUM,
			   </if>
			   <if test="phoName != null and phoName != ''">
			   		pho_name,
			   </if>
			   <if test="processDesc != null and processDesc != ''">
			   		process_desc,
			   </if>
			   <if test="phoDispiayName != null and phoDispiayName != ''">
			   		pho_dispiay_name,
			   </if>
			   <if test="rectifInstruction != null and rectifInstruction != ''">
			   		rectif_instruction,
			   </if>
			   <if test="phoAddress != null and phoAddress != ''">
			   		pho_address,
			   </if>
			   <if test="gdName != null and gdName != ''">
			   		gd_name,
			   </if>
			   <if test="workPermit != null and workPermit != ''">
			   		work_permit,
			   </if>
			   <if test="workPermitNumber != null and workPermitNumber != ''">
			   		work_permit_number,
			   </if>
			   <if test="problemclass != null and problemclass != ''">
			   		PROBLEMCLASS,
			   </if>
			   <if test="profession != null and profession != ''">
			   		PROFESSION,
			   </if>
			   <if test="depet != null and depet != ''">
			   		depet,
			   </if>
			   <if test="interOrOuter != null and interOrOuter != ''">
			   		inter_or_outer,
			   </if>
			   <if test="outerDealDescribe != null and outerDealDescribe != ''">
			   		outer_deal_describe,
			   </if>  
			</trim>
		VALUES
			<trim prefix="(" suffix=")" suffixOverrides=",">
			  <if test="tProblemRepId != null and tProblemRepId != ''">
			   		#{tProblemRepId},
			   </if>
			   <if test="piid != null and piid != ''">
			   		#{piid},
			   </if>
			    <if test="tasId != null and tasId != ''">
			   		#{tasId},
			   </if>
			   <if test="problemtype != null and problemtype != ''">
			   		#{problemtype},
			   </if>
			   <if test="welId != null and welId != ''">
			   		#{welId},
			   </if>
			   <if test="welName != null and welName != ''">
			   		#{welName},
			   </if>
			   <if test="adress != null and adress != ''">
			   		#{adress},
			   </if>
			   <if test="impacts != null and impacts != ''">
			   		#{impacts},
			   </if>
			   <if test="problemdescribe != null and problemdescribe != ''">
			   		#{problemdescribe},
			   </if>
			   <if test="resavepeople != null and resavepeople != ''">
			   		#{resavepeople},
			   </if>
			   <if test="applypeople != null and applypeople != ''">
			   		#{applypeople},
			   </if>
			   <if test="applydate != null">
			   		#{applydate},
			   </if>
			   <if test="problemstate != null and problemstate != ''">
			   		#{problemstate},
			   </if>
			   <if test="remark != null and remark != ''">
			   		#{remark},
			   </if>
			   <if test="remarkone != null and remarkone != ''">
			   		#{remarkone},
			   </if>
			   <if test="remarktwo != null and remarktwo != ''">
			   		#{remarktwo},
			   </if>
			   <if test="remarkthree != null and remarkthree != ''">
			   		#{remarkthree},
			   </if>
			   <if test="supervisoryperson != null and supervisoryperson != ''">
			   		#{supervisoryperson},
			   </if>
			   <if test="maintenanceman != null and maintenanceman != ''">
			   		#{maintenanceman},
			   </if>
			   <if test="rectificationmeasures != null and rectificationmeasures != ''">
			   		#{rectificationmeasures},
			   </if>
			   <if test="rectificationperiod != null and rectificationperiod != ''">
			   		#{rectificationperiod},
			   </if>
			   <if test="isSms != null and isSms != ''">
			   		#{isSms},
			   </if>
			   <if test="smsConment != null and smsConment != ''">
			   		#{smsConment},
			   </if>
			   <if test="smsDate != null">
			   		#{smsDate},
			   </if>
			   <if test="taskPiid != null and taskPiid != ''">
			   		#{taskPiid},
			   </if>
			   <if test="processtype != null and processtype != ''">
			   		#{processtype},
			   </if>
			   <if test="supervisorydate != null">
			   		#{supervisorydate},
			   </if>
			   <if test="supervisorydesc != null and supervisorydesc != ''">
			   		#{supervisorydesc},
			   </if>
			   <if test="tasDistribute != null and tasDistribute != ''">
			   		#{tasDistribute},
			   </if>
			   <if test="departOrCentral != null and departOrCentral != ''">
			   		#{departOrCentral},
			   </if>
			   <if test="terBeginworkDate != null">
			   		#{terBeginworkDate},
			   </if>
			   <if test="terEndworkDate != null">
			   		#{terEndworkDate},
			   </if>
			   <if test="terPlace != null and terPlace != ''">
			   		#{terPlace},
			   </if>
			   <if test="spId != null and spId != ''">
			   		#{spId},
			   </if>
			   <if test="spName != null and spName != ''">
			   		#{spName},
			   </if>
			   <if test="organizationSiteOffice != null and organizationSiteOffice != ''">
			   		#{organizationSiteOffice},
			   </if>
			   <if test="officeProblem != null and officeProblem != ''">
			   		#{officeProblem},
			   </if>
			   <if test="materialsApplication != null and materialsApplication != ''">
			   		#{materialsApplication},
			   </if>
			   <if test="applicationRemark != null and applicationRemark != ''">
			   		#{applicationRemark},
			   </if>
			   <if test="controleApplication != null and controleApplication != ''">
			   		#{controleApplication},
			   </if>
			   <if test="opeCmId != null and opeCmId != ''">
			   		#{opeCmId},
			   </if>
			   <if test="opecardNo != null and opecardNo != ''">
			   		#{opecardNo},
			   </if>
			   <if test="handleTicket != null and handleTicket != ''">
			   		#{handleTicket},
			   </if>
			   <if test="ticketNo != null and ticketNo != ''">
			   		#{ticketNo},
			   </if>
			   <if test="correctiveAction != null and correctiveAction != ''">
			   		#{correctiveAction},
			   </if>
			   <if test="action != null and action != ''">
			   		#{action},
			   </if>
			   <if test="others != null and others != ''">
			   		#{others},
			   </if>
			   <if test="remarkfive != null and remarkfive != ''">
			   		#{remarkfive},
			   </if>
			   <if test="remarksix != null and remarksix != ''">
			   		#{remarksix},
			   </if>
			   <if test="remarkseven != null and remarkseven != ''">
			   		#{remarkseven},
			   </if>
			   <if test="rfid != null and rfid != ''">
			   		#{rfid},
			   </if>
			   <if test="isdownload != null and isdownload != ''">
			   		#{isdownload},
			   </if>
			   <if test="problemnum != null">
			   		#{problemnum},
			   </if>
			   <if test="phoName != null and phoName != ''">
			   		#{phoName},
			   </if>
			   <if test="processDesc != null and processDesc != ''">
			   		#{processDesc},
			   </if>
			   <if test="phoDispiayName != null and phoDispiayName != ''">
			   		#{phoDispiayName},
			   </if>
			   <if test="rectifInstruction != null and rectifInstruction != ''">
			   		#{rectifInstruction},
			   </if>
			   <if test="phoAddress != null and phoAddress != ''">
			   		#{phoAddress},
			   </if>
			   <if test="gdName != null and gdName != ''">
			   		#{gdName},
			   </if>
			   <if test="workPermit != null and workPermit != ''">
			   		#{workPermit},
			   </if>
			   <if test="workPermitNumber != null and workPermitNumber != ''">
			   		#{workPermitNumber},
			   </if>
			   <if test="problemclass != null and problemclass != ''">
			   		#{problemclass},
			   </if>
			   <if test="profession != null and profession != ''">
			   		#{profession},
			   </if>
			   <if test="depet != null and depet != ''">
			   		#{depet},
			   </if>
			   <if test="interOrOuter != null and interOrOuter != ''">
			   		#{interOrOuter},
			   </if>
			   <if test="outerDealDescribe != null and outerDealDescribe != ''">
			   		#{outerDealDescribe},
			   </if>
			</trim>	
	</insert>
	
	
	<!-- ===========================3、修改===============================  -->
	<!-- 3.1、修改一条问题报告数据 	-->
	<!-- public Integer updateOne(ProblemInfo info)	 -->
	<update id="updateOne" parameterType="cn.soa.entity.ProblemInfo">
		UPDATE CZ_TASK_PROBLEM_REPORT_NEW
			<set>
			    <if test="tProblemRepId != null and tProblemRepId != ''">
			   		T_PROBLEM_REP_ID = #{tProblemRepId},
			   </if>
			   <if test="piid != null and piid != ''">
			   		PIID = #{piid},
			   </if>
			    <if test="tasId != null and tasId != ''">
			   		tas_id = #{tasId},
			   </if>
			   <if test="problemtype != null and problemtype != ''">
			   		PROBLEMTYPE = #{problemtype},
			   </if>
			   <if test="welId != null and welId != ''">
			   		wel_id = #{welId},
			   </if>
			   <if test="welName != null and welName != ''">
			   		WEL_NAME = #{welName},
			   </if>
			   <if test="adress != null and adress != ''">
			   		adress = #{adress},
			   </if>
			   <if test="impacts != null and impacts != ''">
			   		impacts = #{impacts},
			   </if>
			   <if test="problemdescribe != null and problemdescribe != ''">
			   		PROBLEMDESCRIBE = #{problemdescribe},
			   </if>
			   <if test="resavepeople != null and resavepeople != ''">
			   		RESAVEPEOPLE = #{resavepeople},
			   </if>
			   <if test="applypeople != null and applypeople != ''">
			   		APPLYPEOPLE = #{applypeople},
			   </if>
			   <if test="applydate != null">
			   		APPLYDATE = #{applydate},
			   </if>
			   <if test="problemstate != null and problemstate != ''">
			   		PROBLEMSTATE = #{problemstate},
			   </if>
			   <if test="remark != null and remark != ''">
			   		remark = #{remark},
			   </if>
			   <if test="remarkone != null and remarkone != ''">
			   		remarkone = #{remarkone},
			   </if>
			   <if test="remarktwo != null and remarktwo != ''">
			   		remarktwo = #{remarktwo},
			   </if>
			   <if test="remarkthree != null and remarkthree != ''">
			   		remarkthree = #{remarkthree},
			   </if>
			   <if test="supervisoryperson != null and supervisoryperson != ''">
			   		supervisoryperson = #{supervisoryperson},
			   </if>
			   <if test="maintenanceman != null and maintenanceman != ''">
			   		maintenanceman = #{maintenanceman},
			   </if>
			   <if test="rectificationmeasures != null and rectificationmeasures != ''">
			   		rectificationmeasures = #{rectificationmeasures},
			   </if>
			   <if test="rectificationperiod != null and rectificationperiod != ''">
			   		rectificationperiod = #{rectificationperiod},
			   </if>
			   <if test="isSms != null and isSms != ''">
			   		is_sms = #{isSms},
			   </if>
			   <if test="smsConment != null and smsConment != ''">
			   		sms_conment = #{smsConment},
			   </if>
			   <if test="smsDate != null">
			   		sms_date = #{smsDate},
			   </if>
			   <if test="taskPiid != null and taskPiid != ''">
			   		task_piid = #{taskPiid},
			   </if>
			   <if test="processtype != null and processtype != ''">
			   		processtype = #{processtype},
			   </if>
			   <if test="supervisorydate != null">
			   		supervisorydate = #{supervisorydate},
			   </if>
			   <if test="supervisorydesc != null and supervisorydesc != ''">
			   		supervisorydesc = #{supervisorydesc},
			   </if>
			   <if test="tasDistribute != null and tasDistribute != ''">
			   		tas_distribute = #{tasDistribute},
			   </if>
			   <if test="departOrCentral != null and departOrCentral != ''">
			   		depart_or_central = #{departOrCentral},
			   </if>
			   <if test="terBeginworkDate != null">
			   		ter_beginwork_date = #{terBeginworkDate},
			   </if>
			   <if test="terEndworkDate != null">
			   		ter_endwork_date = #{terEndworkDate},
			   </if>
			   <if test="terPlace != null and terPlace != ''">
			   		ter_place = #{terPlace},
			   </if>
			   <if test="spId != null and spId != ''">
			   		sp_id = #{spId},
			   </if>
			   <if test="spName != null and spName != ''">
			   		sp_name = #{spName},
			   </if>
			   <if test="organizationSiteOffice != null and organizationSiteOffice != ''">
			   		organization_site_officE = #{organizationSiteOffice},
			   </if>
			   <if test="officeProblem != null and officeProblem != ''">
			   		office_problem = #{officeProblem},
			   </if>
			   <if test="materialsApplication != null and materialsApplication != ''">
			   		materials_application = #{materialsApplication},
			   </if>
			   <if test="applicationRemark != null and applicationRemark != ''">
			   		application_remark = #{applicationRemark},
			   </if>
			   <if test="controleApplication != null and controleApplication != ''">
			   		controle_application = #{controleApplication},
			   </if>
			   <if test="opeCmId != null and opeCmId != ''">
			   		ope_cm_id = #{opeCmId},
			   </if>
			   <if test="opecardNo != null and opecardNo != ''">
			   		ope_card_no = #{opecardNo},
			   </if>
			   <if test="handleTicket != null and handleTicket != ''">
			   		handle_ticket = #{handleTicket},
			   </if>
			   <if test="ticketNo != null and ticketNo != ''">
			   		ticket_no = #{ticketNo},
			   </if>
			   <if test="correctiveAction != null and correctiveAction != ''">
			   		corrective_action = #{correctiveAction},
			   </if>
			   <if test="action != null and action != ''">
			   		action = #{action},
			   </if>
			   <if test="others != null and others != ''">
			   		others = #{others},
			   </if>
			   <if test="remarkfive != null and remarkfive != ''">
			   		REMARKFIVE = #{remarkfive},
			   </if>
			   <if test="remarksix != null and remarksix != ''">
			   		REMARKSIX = #{remarksix},
			   </if>
			   <if test="remarkseven != null and remarkseven != ''">
			   		remarkseven = #{remarkseven},
			   </if>
			   <if test="rfid != null and rfid != ''">
			   		RFID = #{rfid},
			   </if>
			   <if test="isdownload != null and isdownload != ''">
			   		isdownload = #{isdownload},
			   </if>
			   <if test="problemnum != null">
			   		PROBLEMNUM = #{problemnum},
			   </if>
			   <if test="phoName != null and phoName != ''">
			   		pho_name = #{phoName},
			   </if>
			   <if test="processDesc != null and processDesc != ''">
			   		process_desc = #{processDesc},
			   </if>
			   <if test="phoDispiayName != null and phoDispiayName != ''">
			   		pho_dispiay_name = #{phoDispiayName},
			   </if>
			   <if test="rectifInstruction != null and rectifInstruction != ''">
			   		rectif_instruction = #{rectifInstruction},
			   </if>
			   <if test="phoAddress != null and phoAddress != ''">
			   		pho_address = #{phoAddress},
			   </if>
			   <if test="gdName != null and gdName != ''">
			   		gd_name = #{gdName},
			   </if>
			   <if test="workPermit != null and workPermit != ''">
			   		work_permit = #{workPermit},
			   </if>
			   <if test="workPermitNumber != null and workPermitNumber != ''">
			   		work_permit_number = #{workPermitNumber},
			   </if>
			   <if test="problemclass != null and problemclass != ''">
			   		PROBLEMCLASS = #{problemclass},
			   </if>
			   <if test="profession != null and profession != ''">
			   		PROFESSION = #{profession},
			   </if>
			   <if test="depet != null and depet != ''">
			   		depet = #{depet},
			   </if>
			   <if test="interOrOuter != null and interOrOuter != ''">
			   		inter_or_outer = #{interOrOuter},
			   </if>
			   <if test="outerDealDescribe != null and outerDealDescribe != ''">
			   		outer_deal_describe = #{outerDealDescribe},
			   </if>
			</set>
			<where>
				T_PROBLEM_REP_ID = #{tProblemRepId}
			</where>
	</update>

	<!-- 根据流程标识字段更新问题问题评估字段 -->
	<!-- Integer updateProblemDescribeByPiid(String piid); -->
	<update id="updateProblemDescribeByPiid" parameterType="cn.soa.entity.ProblemInfo">
		UPDATE 
			CZ_TASK_PROBLEM_REPORT_NEW 
			<set>
			    <if test="tProblemRepId != null and tProblemRepId != ''">
			   		T_PROBLEM_REP_ID = #{tProblemRepId},
			   </if>
			    <if test="tasId != null and tasId != ''">
			   		tas_id = #{tasId},
			   </if>
			   <if test="problemtype != null and problemtype != ''">
			   		PROBLEMTYPE = #{problemtype},
			   </if>
			   <if test="welId != null and welId != ''">
			   		wel_id = #{welId},
			   </if>
			   <if test="welName != null and welName != ''">
			   		WEL_NAME = #{welName},
			   </if>
			   <if test="adress != null and adress != ''">
			   		adress = #{adress},
			   </if>
			   <if test="impacts != null and impacts != ''">
			   		impacts = #{impacts},
			   </if>
			   <if test="problemdescribe != null and problemdescribe != ''">
			   		PROBLEMDESCRIBE = #{problemdescribe},
			   </if>
			   <if test="resavepeople != null and resavepeople != ''">
			   		RESAVEPEOPLE = #{resavepeople},
			   </if>
			   <if test="applypeople != null and applypeople != ''">
			   		APPLYPEOPLE = #{applypeople},
			   </if>
			   <if test="applydate != null">
			   		APPLYDATE = #{applydate},
			   </if>
			   <if test="problemstate != null and problemstate != ''">
			   		PROBLEMSTATE = #{problemstate},
			   </if>
			   <if test="remark != null and remark != ''">
			   		remark = #{remark},
			   </if>
			   <if test="remarkone != null and remarkone != ''">
			   		remarkone = #{remarkone},
			   </if>
			   <if test="remarktwo != null and remarktwo != ''">
			   		remarktwo = #{remarktwo},
			   </if>
			   <if test="remarkthree != null and remarkthree != ''">
			   		remarkthree = #{remarkthree},
			   </if>
			   <if test="supervisoryperson != null and supervisoryperson != ''">
			   		supervisoryperson = #{supervisoryperson},
			   </if>
			   <if test="maintenanceman != null and maintenanceman != ''">
			   		maintenanceman = #{maintenanceman},
			   </if>
			   <if test="rectificationmeasures != null and rectificationmeasures != ''">
			   		rectificationmeasures = #{rectificationmeasures},
			   </if>
			   <if test="rectificationperiod != null and rectificationperiod != ''">
			   		rectificationperiod = #{rectificationperiod},
			   </if>
			   <if test="isSms != null and isSms != ''">
			   		is_sms = #{isSms},
			   </if>
			   <if test="smsConment != null and smsConment != ''">
			   		sms_conment = #{smsConment},
			   </if>
			   <if test="smsDate != null">
			   		sms_date = #{smsDate},
			   </if>
			   <if test="taskPiid != null and taskPiid != ''">
			   		task_piid = #{taskPiid},
			   </if>
			   <if test="processtype != null and processtype != ''">
			   		processtype = #{processtype},
			   </if>
			   <if test="supervisorydate != null">
			   		supervisorydate = #{supervisorydate},
			   </if>
			   <if test="supervisorydesc != null and supervisorydesc != ''">
			   		supervisorydesc = #{supervisorydesc},
			   </if>
			   <if test="tasDistribute != null and tasDistribute != ''">
			   		tas_distribute = #{tasDistribute},
			   </if>
			   <if test="departOrCentral != null and departOrCentral != ''">
			   		depart_or_central = #{departOrCentral},
			   </if>
			   <if test="terBeginworkDate != null">
			   		ter_beginwork_date = #{terBeginworkDate},
			   </if>
			   <if test="terEndworkDate != null">
			   		ter_endwork_date = #{terEndworkDate},
			   </if>
			   <if test="terPlace != null and terPlace != ''">
			   		ter_place = #{terPlace},
			   </if>
			   <if test="spId != null and spId != ''">
			   		sp_id = #{spId},
			   </if>
			   <if test="spName != null and spName != ''">
			   		sp_name = #{spName},
			   </if>
			   <if test="organizationSiteOffice != null and organizationSiteOffice != ''">
			   		organization_site_officE = #{organizationSiteOffice},
			   </if>
			   <if test="officeProblem != null and officeProblem != ''">
			   		office_problem = #{officeProblem},
			   </if>
			   <if test="materialsApplication != null and materialsApplication != ''">
			   		materials_application = #{materialsApplication},
			   </if>
			   <if test="applicationRemark != null and applicationRemark != ''">
			   		application_remark = #{applicationRemark},
			   </if>
			   <if test="controleApplication != null and controleApplication != ''">
			   		controle_application = #{controleApplication},
			   </if>
			   <if test="opeCmId != null and opeCmId != ''">
			   		ope_cm_id = #{opeCmId},
			   </if>
			   <if test="opecardNo != null and opecardNo != ''">
			   		ope_card_no = #{opecardNo},
			   </if>
			   <if test="handleTicket != null and handleTicket != ''">
			   		handle_ticket = #{handleTicket},
			   </if>
			   <if test="ticketNo != null and ticketNo != ''">
			   		ticket_no = #{ticketNo},
			   </if>
			   <if test="correctiveAction != null and correctiveAction != ''">
			   		corrective_action = #{correctiveAction},
			   </if>
			   <if test="action != null and action != ''">
			   		action = #{action},
			   </if>
			   <if test="others != null and others != ''">
			   		others = #{others},
			   </if>
			   <if test="remarkfive != null and remarkfive != ''">
			   		REMARKFIVE = #{remarkfive},
			   </if>
			   <if test="remarksix != null and remarksix != ''">
			   		REMARKSIX = #{remarksix},
			   </if>
			   <if test="remarkseven != null and remarkseven != ''">
			   		remarkseven = #{remarkseven},
			   </if>
			   <if test="rfid != null and rfid != ''">
			   		RFID = #{rfid},
			   </if>
			   <if test="isdownload != null and isdownload != ''">
			   		isdownload = #{isdownload},
			   </if>
			   <if test="problemnum != null">
			   		PROBLEMNUM = #{problemnum},
			   </if>
			   <if test="phoName != null and phoName != ''">
			   		pho_name = #{phoName},
			   </if>
			   <if test="processDesc != null and processDesc != ''">
			   		process_desc = #{processDesc},
			   </if>
			   <if test="phoDispiayName != null and phoDispiayName != ''">
			   		pho_dispiay_name = #{phoDispiayName},
			   </if>
			   <if test="rectifInstruction != null and rectifInstruction != ''">
			   		rectif_instruction = #{rectifInstruction},
			   </if>
			   <if test="phoAddress != null and phoAddress != ''">
			   		pho_address = #{phoAddress},
			   </if>
			   <if test="gdName != null and gdName != ''">
			   		gd_name = #{gdName},
			   </if>
			   <if test="workPermit != null and workPermit != ''">
			   		work_permit = #{workPermit},
			   </if>
			   <if test="workPermitNumber != null and workPermitNumber != ''">
			   		work_permit_number = #{workPermitNumber},
			   </if>
			   <if test="problemclass != null and problemclass != ''">
			   		PROBLEMCLASS = #{problemclass},
			   </if>
			   <if test="profession != null and profession != ''">
			   		PROFESSION = #{profession},
			   </if>
			   <if test="depet != null and depet != ''">
			   		depet = #{depet},
			   </if>
			   <if test="interOrOuter != null and interOrOuter != ''">
			   		inter_or_outer = #{interOrOuter},
			   </if>
			   <if test="outerDealDescribe != null and outerDealDescribe != ''">
			   		outer_deal_describe = #{outerDealDescribe},
			   </if>
			</set>
			<!-- problemdescribe=#{problemdescribe} --> 
		WHERE 
			piid=#{piid}
	
	</update>
	
	<!-- 根据bsid，更新业务表数据的piid -->
	<update id="updatePiidByBsid">
		UPDATE 
			CZ_TASK_PROBLEM_REPORT_NEW 
		SET 
			piid=#{piid} 
		WHERE 
			T_PROBLEM_REP_ID=#{bsid}
	
	</update>
	
	<!-- 根据piid，修改流程的超期状态-->
	<update id="updateTimeoverState" >
		UPDATE CZ_TASK_PROBLEM_REPORT_NEW 
		SET REMARKTHREE = #{ state }
		where piid = #{ piid }
	</update>
	
	
	<!-- 更新一条问题报告数据  -->
	<!-- public Integer updateEstiByPiid(ProblemInfo info); -->
	<update id="updateEstiByPiid">
		UPDATE 
			CZ_TASK_PROBLEM_REPORT_NEW 
		SET 
			remark=#{remark},
			problemdescribe=#{problemdescribe},
			<choose>
				<when test="rectificationperiod != null">
					rectificationperiod=#{rectificationperiod},
				</when>
				<otherwise>
					rectificationperiod=null,
				</otherwise>
			</choose>
			ticket_no=#{ticketNo}
		WHERE 
			piid=#{piid}
	
	</update>
	
	<sql id="userOrganization">
		ORGID, USERNUM, NAME, PARENT_ID, USER_PASSWORD, STATE,
		IS_PARENT, NOTE,
		REMARK1,
		REMARK2
	</sql>
	
	<!-- 根据属地名称去找另外的属地 -->
	<!-- public List<UserOrganization> findDeptByProblemtype(String problemtype); -->
	<select id="findDeptByProblemtype" resultType="cn.soa.entity.UserOrganization">
		SELECT
			<include refid="userOrganization"></include>
		FROM 
			iot_user_organization
		WHERE 
			name != #{problemtype} AND is_parent = 0 
		AND PARENT_ID != (
			select 
				USERNUM 
			from
				IOT_USER_ORGANIZATION 
			where 
				name =#{problemtype})
	</select>
	
	<!-- 根据用部分problemdescribe查询对应的数据 -->
	<!-- List<Title> findByProblemdescribe(String problemdescribe); -->
	<select id="findByProblemdescribe"
		resultType="cn.soa.entity.ProblemInfo">
		SELECT 
			DISTINCT problemdescribe 
		FROM 
			CZ_TASK_PROBLEM_REPORT_NEW 
		WHERE 
			problemdescribe LIKE CONCAT(#{problemdescribe},'%')
 
        and rownum <![CDATA[<=]]> 5
	</select>
	
	<delete id="deleteByPiid" parameterType="string">
		delete from CZ_TASK_PROBLEM_REPORT_NEW
		where piid=#{piid}
	</delete>
	
	<delete id="deleteByBsid" parameterType="string">
		delete from CZ_TASK_PROBLEM_REPORT_NEW
		where T_PROBLEM_REP_ID=#{bsid}
	</delete>
	
	<delete id="deleteByRepid" parameterType="string">
		delete from CZ_TASK_PROBLEM_REPORT_NEW
		where T_PROBLEM_REP_ID=#{repid}
	</delete>
</mapper>
 

